<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-adsense-account" content="ca-pub-9129984537709137">
<link rel="icon" type="image/png" href="logo.png">
<title>LinkSnap</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

<style>
  body {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background: #111;
    color: #eee;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h2 { margin-bottom: 5px; }

  .instructions {
    font-size: 0.9em;
    color: #aaa;
    text-align: center;
    max-width: 420px;
    margin-bottom: 25px;
    line-height: 1.5;
  }

  .instructions strong { color: #fff; }

  /* Drag & Drop */
  #drop-area {
    border: 2px dashed #444;
    padding: 30px;
    border-radius: 12px;
    width: 100%;
    max-width: 400px;
    text-align: center;
    margin-bottom: 20px;
    transition: background 0.2s, border-color 0.2s;
    cursor: pointer;
  }
  #drop-area.hover { background: #222; border-color: #eee; }
  #drop-area input { display: none; }

  #drop-area label {
    display: inline-block;
    padding: 12px 25px;
    background: #eee;
    color: #111;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
  }

  /* Progress bar */
  #progress-container {
    width: 100%;
    max-width: 400px;
    background: #222;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 20px;
    display: none;
  }
  #progress-bar {
    height: 12px;
    width: 0%;
    background: #eee;
  }

  #results {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 400px;
    gap: 12px;
  }

  .link-card {
    background: #222;
    padding: 12px;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .link-preview {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .link-preview img.thumbnail {
    width: 60px;
    height: 34px;
    object-fit: cover;
    border-radius: 4px;
    background: #000;
  }

  .link-title {
    font-weight: bold;
    font-size: 0.95em;
    color: #fff;
    word-break: break-word;
  }

  .open-btn {
    background: #eee;
    color: #111;
    border: none;
    border-radius: 6px;
    padding: 8px;
    cursor: pointer;
    font-weight: bold;
  }
</style>
</head>

<body>

<h2>LinkSnap</h2>

<div class="instructions">
  <strong>Extract links from screenshots instantly.</strong><br><br>
  üì∏ Take a screenshot of a link<br>
  ‚úÇÔ∏è <strong>Crop the image so only the link is visible</strong><br>
  üì§ Drag & drop or choose the image<br>
  üîó Open the detected link instantly<br><br>
  <small>Tip: Clean crops = higher accuracy</small>
</div>

<div id="drop-area">
  <p>Drag & drop an image here</p>
  <input type="file" id="fileInput" accept="image/*">
  <label for="fileInput">Choose File</label>
</div>

<div id="progress-container">
  <div id="progress-bar"></div>
</div>

<div id="results"></div>

<script>
const dropArea = document.getElementById("drop-area");
const input = document.getElementById("fileInput");
const progressContainer = document.getElementById("progress-container");
const progressBar = document.getElementById("progress-bar");
const results = document.getElementById("results");

['dragenter','dragover','dragleave','drop'].forEach(e =>
  dropArea.addEventListener(e, ev => ev.preventDefault())
);
['dragenter','dragover'].forEach(() =>
  dropArea.classList.add('hover')
);
['dragleave','drop'].forEach(() =>
  dropArea.classList.remove('hover')
);

dropArea.addEventListener('drop', e => {
  if(e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
});
input.addEventListener('change', () => {
  if(input.files.length > 0) handleFile(input.files[0]);
});

// === JS BELOW IS UNCHANGED ===

function processImage(file, maxWidth=1200, maxHeight=1200) {
  return new Promise(resolve => {
    const img = new Image();
    img.onload = () => {
      let {width,height} = img;
      if(width>maxWidth){height*=maxWidth/width;width=maxWidth;}
      if(height>maxHeight){width*=maxHeight/height;height=maxHeight;}
      const canvas=document.createElement("canvas");
      canvas.width=width;canvas.height=height;
      const ctx=canvas.getContext("2d");
      ctx.drawImage(img,0,0,width,height);
      const imageData = ctx.getImageData(0,0,width,height);
      for(let i=0;i<imageData.data.length;i+=4){
        const avg=(imageData.data[i]+imageData.data[i+1]+imageData.data[i+2])/3;
        imageData.data[i]=avg;
        imageData.data[i+1]=avg;
        imageData.data[i+2]=avg;
      }
      ctx.putImageData(imageData,0,0);
      resolve(canvas);
    };
    img.src = URL.createObjectURL(file);
  });
}

function getYouTubeThumbnail(url) {
  try {
    const vidMatch = url.match(/(?:v=|youtu\.be\/)([\w-]+)/);
    if(vidMatch) return `https://img.youtube.com/vi/${vidMatch[1]}/mqdefault.jpg`;
  } catch {}
  return '';
}

function getFavicon(url){
  try {
    const u=new URL(url);
    return `https://www.google.com/s2/favicons?domain=${u.hostname}`;
  } catch { return ''; }
}

async function handleFile(file){
  progressContainer.style.display='block';
  progressBar.style.width='0%';
  results.innerHTML="";

  try{
    const canvas = await processImage(file);
    const {data:{text}} = await Tesseract.recognize(canvas,'eng',{
      logger:m=>{
        if(m.status==='recognizing text'){
          progressBar.style.width = `${Math.round(m.progress*100)}%`;
        }
      }
    });

    progressContainer.style.display='none';

    const links = text.match(/https?:\/\/[^\s]+/gi) || [];

    if(!links.length){
      results.innerText="No link found";
      return;
    }

    for(const link of links){
      const card=document.createElement("div");
      card.className="link-card";

      let thumb = link.includes('youtube') ? getYouTubeThumbnail(link) : getFavicon(link);

      const preview=document.createElement("div");
      preview.className="link-preview";

      if(thumb){
        const img=document.createElement("img");
        img.className="thumbnail";
        img.src=thumb;
        preview.appendChild(img);
      }

      const title=document.createElement("div");
      title.className="link-title";
      title.innerText = link.length>50 ? link.slice(0,50)+"..." : link;

      preview.appendChild(title);
      card.appendChild(preview);

      const btn=document.createElement("button");
      btn.className="open-btn";
      btn.innerText="Open Link";
      btn.onclick=()=>window.open(link,"_blank");

      card.appendChild(btn);
      results.appendChild(card);
    }

  }catch(err){
    progressContainer.style.display='none';
    results.innerText="Error scanning image";
    console.error(err);
  }
}
</script>

</body>
</html>

